kind: pipeline
type: docker
name: default

steps:
- name: publish-docker
  image: plugins/docker
  network_mode: registry-network
  settings:
    repo: registry:5000/ringring-service
    registry: registry:5000
    insecure: true
- name: publish-docker-postgres
  image: plugins/docker
  network_mode: registry-network
  settings:
    dockerfile: postgres/Dockerfile
    repo: registry:5000/ringring-service-postgres
    registry: registry:5000
    insecure: true
- name: trigger-vm-image-creation
  image: plugins/downstream
  settings:
    server: http://droneci.sect.tu-berlin.de
    token: JhJcbf3l5zw3kAhsc0imV1J35pXJW7aI
    fork: true
    repositories:
      - FlorianNachtigall/drone-testing
